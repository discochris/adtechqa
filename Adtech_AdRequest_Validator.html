<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.1.8/jsoneditor.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.1.8/jsoneditor.min.js"></script>
	<link href="https://unpkg.com/intro.js/minified/introjs.min.css" rel="stylesheet">
	<script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
	<style>
		table {
			border-collapse: collapse;
			width: 100%;
		}

		table,
		th,
		td {
			border: 1px solid #ddd;
		}

		td {
			max-width: 300px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
	</style>
	<script>
		const getData = (device, profileName, adrequestParam, deviceAdTracking, region) => {
			let jsonData = {
				"commonParams":
				{
					"deviceAdtrackingEnabled":
					{
						"adult":
						{
							"_fw_is_lat": "0",
							"_fw_did": "855dfffc-8e47-4661-9b3c-3b625d487056",
							"paln": "AQzzBGQEdiomKZVi7Uc1s-D87_l6er9Z6tgwhA8HdqUYtrMOPbLGG1_XPf5TSX2F7GKwbYN-6KE-tw6ZADczHrFq_bwA0srLNa9vjydhusRkwAp03wDRy_AD-4ANs7qUO-tHQWz4xowCLP_j8t-lOuQAL9wikvONM2PZ6VISYPl48RR59fqgsyv8a0rl2DJpPuo2UJbEK9wG_WSAIPW9NZvzev0cGD5iD2vK4chkNBL0LGvMi0N6TslCQ-2YJeqfUtWP3ZsDokLwr5Va9x0ZxNhjbyo7QgsUIBbckbaW3AnGW24adGDS-J9nDoBZs66r6UBJ7mipC1rufakbGgVnmqxJU-jFKQauzWKxTaqPIDYdjiXW11Eu0Zw7vd_IgqtUIWjiRyJttGFmwD_z1bCqoo9XR927o2GoKuvCbGNuIh6I5bxthTtPSEdF40SJ2mIyipYWv6sDhK2aEMGBRncL1-tDUTCJCfdQK4IeUSHWzVyejZ2YLccmnYa88LwkA7Hib-MDQ13VYc30_oYlcA8dvbEbhL65l3sytSD3zd6qw2U3m1ekpib3yDYuhuFAEaxqLryQlVpZyQav4OCK4AOHepcpyXVmH5lOmdbbtDFdOGq2957DEzwXGMYAWyhKRQjU8_RI2-fLX6ISAGdkE9Li8bSQIAm4fHlXhvuVMXjDnK821dHbHj8Uu5DJri2_FyOwh90wP5VqrM_XCsNIcvTvEVJQ6nlei5QfEbZN095CX_J2liouIbumqstp5xAjxgAwG2f3QVKSpZHCg9XIhBXejtpCTudEu_QP_6MXv8PFJ-VTJLq9gqrLOWuv9FfpuvcmP71q59Ag_4q66PNQuTw3xRd4rDkXJesXS0mxhj09r7NTThoXu3boss1wuwTMBPYtTvkfi8nKW5wDqcn5dt254fJTTbfx-6VE5qSblZzn8cZf-Z-NBuO-IsxuHcsMFJLozFjYnpXuu12mCJdoLju_GEMfdT3lEfDnBlubKb0omTRbRyfpoxIW74wtvPrvj2lfJJoRDQgJFdb1-Q-_9E9yL21IHto-BD0kFx0TYd77o6OxuujSos7mBoVxDXqqnjufbPUosjerEpJCpzNvj8wlSE5kSIlJoqxVnXFDCmihblUwCCOLIejxyDCQNF2CZH8y5rV1_USaKTVeX5uKq_-jrMlLPvfTqJsAYSLo_ZAK4UKLrMGOSybz4mAsVPmiEU8kqhFJk2ng"
						},
						"kids":
						{
							"_fw_is_lat": "1",
							"_fw_did": null,
							"paln": null
						}
					},
					"deviceAdtrackingDisabled":
					{
						"adult": {
							"_fw_is_lat": "1",
							"_fw_did": null,
							"paln": null
						},
						"kids":
						{
							"_fw_is_lat": "1",
							"_fw_did": null,
							"paln": null
						}
					},
					"flag": "fbad scpv emcr sltp qtcb slcb aeti vicb dtrd",
					"resp": "vmap1 vast4",
					"mode": "on-demand"
				},
				"USA": {
					"nw": "191700",
					"afid": "370478572",
					"hostvalue": "https://2ecd5.v.fwmrm.net"
				},
				"AUS": {
					"nw": "386344",
					"afid": "388328657",
					"hostvalue": "https://5e529.v.fwmrm.net"
				},
				"BR": {
					"nw": "386344",
					"afid": "388328657",
					"hostvalue": "https://5e528.v.fwmrm.net"
				},
				"Chrome": {
					"platform": "web",
					"_fw_us_privacy": "1---",
					"metr": "135",
					"_fw_gdpr": "0",
					"adult": {
						"USA": {
							"playername": "BeamPlayerDesktop",
							"csid": "beam/web/desktop",
							"prof": "191700:beam_web_desktop_vod_test",
						},
						"AUS": {
							"playername": "BeamPlayerDesktop/5.10.0",
							"csid": "apac/max/AU/web/desktop",
							"prof": "386344:dni_max_apac_web_vod_test",
						},
						"BR": {
							"playername": "BeamPlayerDesktop",
							"csid": "beam/web/desktop",
							"prof": "191700:beam_web_desktop_vod_test",
						},

						"_fw_coppa": "0",
						"restrictedProfile": "0"
					},
					"kids": {
						"USA": {
							"playername": "BeamPlayerDesktop",
							"csid": "kidsprofile/beam/web/desktop",
							"prof": "191700:beam_web_desktop_vod_test",
						},
						"AUS": {
							"playername": "BeamPlayerDesktop/5.10.0",
							"csid": "apac/max/AU/web/desktop",
							"prof": "386344:dni_max_apac_web_vod_test",
						},
						"BR": {
							"playername": "BeamPlayerDesktop",
							"csid": "kidsprofile/beam/web/desktop",
							"prof": "191700:beam_web_desktop_vod_test",
						},

						"_fw_coppa": "1",
						"restrictedProfile": "1"
					}
				},
				"Android": {
					"playername": "DiscoveryPlayerAndroidgooglePlay/4.8.0",
					"platform": "android",
					"_fw_us_privacy": "1---",
					"metr": "135",
					"_fw_gdpr": "0",
					"adult": {
						"USA": {
							"csid": "beam/app/android/phone",
							"prof": "191700:beam_app_android_vod_test",
						},
						"BR": {
							"csid": "beam/app/android/phone",
							"prof": "191700:beam_app_android_vod_test",
						},
						"_fw_coppa": "0",
						"restrictedProfile": "0"
					},
					"kids": {
						"USA": {
							"csid": "beam/app/android/phone",
							"prof": "191700:beam_app_android_vod_test",
						},
						"BR": {
							"csid": "beam/app/android/phone",
							"prof": "191700:beam_app_android_vod_test",
						},
						"_fw_coppa": "1",
						"restrictedProfile": "1"
					}
				}
			}

			let expectedData;
			switch (adrequestParam) {
				case "_fw_is_lat":
				case "paln":
					if (deviceAdTracking === "enabled") {
						expectedData =
							jsonData.commonParams.deviceAdtrackingEnabled[profileName][
							adrequestParam
							];
					} else if (deviceAdTracking === "disabled") {
						expectedData =
							jsonData.commonParams.deviceAdtrackingDisabled[profileName][
							adrequestParam
							];
					}
					break;
				case "_fw_coppa":
				case "restrictedProfile":
					expectedData = jsonData[device][profileName][adrequestParam];
					break;
				case "csid":
				case "prof":
				case "playername":
					expectedData = jsonData[device][profileName][region][adrequestParam];
					break;
				case "flag":
				case "resp":
				case "mode":
					expectedData = jsonData.commonParams[adrequestParam];
					break;
				case "nw":
				case "afid":
				case "hostvalue":
					expectedData = jsonData[region][adrequestParam];
					break;					
				default:
					expectedData = jsonData[device][adrequestParam];
					console.log("Expected data is " + expectedData);
			}

			return expectedData;
		}

		const validateParam = (actualParam, actualParamValue, expectedParamValue, count, table1, rowrow) => {
			for (i = 0; i < 1; i++) {

				var cell1 = document.createElement('td');
				var text1 = document.createTextNode(count);


				cell1.appendChild(text1);
				rowrow.appendChild(cell1);

				var cell2 = document.createElement('td');
				var text2 = document.createTextNode(actualParam);


				cell2.appendChild(text2);
				rowrow.appendChild(cell2);

				var cell3 = document.createElement('td');
				var text3 = document.createTextNode(actualParamValue);


				cell3.appendChild(text3);
				rowrow.appendChild(cell3);

				if (actualParam.includes('not present in the url')) {
					cell3.style.backgroundColor = "red";
				}

				var cell4 = document.createElement('td');
				var text4 = document.createTextNode(expectedParamValue);

				cell4.appendChild(text4);
				rowrow.appendChild(cell4);

				var cell5 = document.createElement('td');
				var text5 = "";

				if (["_fw_did"].includes(actualParam)) {
					if (deviceAdTracking === "disabled") {
						if (!actualParamValue) {
							text5 = document.createTextNode("PASS");
							cell5.appendChild(text5);
							rowrow.appendChild(cell5);
							cell5.style.backgroundColor = "#6ae66a";
						} else {
							text5 = document.createTextNode("FAIL");
							cell5.appendChild(text5);
							rowrow.appendChild(cell5);
							cell5.style.backgroundColor = "red";
						}
					} else if (deviceAdTracking === "enabled") {
						if (actualParamValue) {
							text5 = document.createTextNode("PASS");
							cell5.appendChild(text5);
							rowrow.appendChild(cell5);
							cell5.style.backgroundColor = "#6ae66a";
						} else {
							text5 = document.createTextNode("FAIL");
							cell5.appendChild(text5);
							rowrow.appendChild(cell5);
							cell5.style.backgroundColor = "red";
						}
					}
				} else if (actualParamValue == expectedParamValue) {
					text5 = document.createTextNode("PASS");
					cell5.appendChild(text5);
					rowrow.appendChild(cell5);
					cell5.style.backgroundColor = "#6ae66a";
				} else {
					text5 = document.createTextNode("FAIL");
					cell5.appendChild(text5);
					rowrow.appendChild(cell5);
					cell5.style.backgroundColor = "red";
				}

			}
			table1.appendChild(rowrow);
		}


		//===================================================================================================================

		const validateAdditionParam = (actualParam, actualParamValue, count, table1, rowrow) => {
			for (i = 0; i < 1; i++) {

				var cell1 = document.createElement('td');
				var text1 = document.createTextNode(count);


				cell1.appendChild(text1);
				rowrow.appendChild(cell1);

				var cell2 = document.createElement('td');
				var text2 = document.createTextNode(actualParam);


				cell2.appendChild(text2);
				rowrow.appendChild(cell2);

				var cell3 = document.createElement('td');
				var text3 = document.createTextNode(actualParamValue);


				cell3.appendChild(text3);
				rowrow.appendChild(cell3);

				if (actualParam.includes('not present in the url')) {
					cell3.style.backgroundColor = "red";
				}

				var cell4 = document.createElement('td');
				var text4 = document.createTextNode("Expected String/Numeric Value");

				cell4.appendChild(text4);
				rowrow.appendChild(cell4);

				var cell5 = document.createElement('td');
				var text5 = "";

				if (actualParamValue) {
					text5 = document.createTextNode("PASS");
					cell5.appendChild(text5);
					rowrow.appendChild(cell5);
					cell5.style.backgroundColor = "#6ae66a";
				} else {
					text5 = document.createTextNode("FAIL");
					cell5.appendChild(text5);
					rowrow.appendChild(cell5);
					cell5.style.backgroundColor = "red";
				}

			}
			table1.appendChild(rowrow);

		}

		async function add() {
			document.getElementById("tableBody").innerHTML = "";
			document.getElementById("tableBody2").innerHTML = "";
			let adUrl = document.getElementById("url").value;
			let profileName = document.getElementById("profile").value;
			let device = document.getElementById("device").value;
			let deviceAdTracking = document.getElementById("deviceAdTrackingSetting").value;
			let region = document.getElementById("Country").value;
			let appVersion = document.getElementById("appVersion").value;

			document.getElementById("myText").innerHTML = adUrl;

			var url = new URL(adUrl);
			let search = new URLSearchParams(url.search);
			let paramArr = ['nw', 'csid', 'caid', 'hostvalue', 'afid', 'pvrn', 'vprn', 'flag', 'metr', 'prof', 'resp', 'vdur', 'vip', 'mode', '_fw_vcid2', 'accountid', '_fw_did', '_fw_h_user_agent', '_fw_h_referer', '_fw_coppa', 'restrictedProfile', '_fw_gdpr', '_fw_is_lat', '_fw_atts', '_fw_us_privacy', 'preroll', 'product', 'paln', 'platform', 'program_id', 'playbackId', 'playername', '_fw_nielsen_app_id', 'ptgt', 'tpcl', 'cpsq', 'tpos', 'novpaid', '_fw_cookie_consent', '_fw_gdpr_consent'];
			//let paramArr = ['_fw_coppa','restrictedProfile'];
			let paramForValidation = ['nw', 'csid', 'hostvalue', 'afid', 'flag', 'metr', 'prof', 'resp', 'mode', '_fw_vcid2', '_fw_coppa', 'restrictedProfile', '_fw_gdpr', '_fw_is_lat', '_fw_atts', '_fw_us_privacy', 'platform', 'playername']



			//console.log("params are "+JSON.stringify(expData));
			//console.log(expData.commonParams);
			let count1 = 1;
			let count2 = 1;

			for (var i = 0; i < paramArr.length; i++) {
				var adRequestParam = paramArr[i];
				var actualParamValue = "";
				let expectedParam;
				if (search.has(paramArr[i])) {
					if (adRequestParam === 'vprn') {
						let data = search.get(adRequestParam);
						actualParamValue = data.split(';')[0];
					}
					else {
						actualParamValue = search.get(adRequestParam);
					}
				} else {
					if (adRequestParam === 'hostvalue') {
						const { protocol, hostname } = url;
						actualParamValue = `${protocol}//${hostname}`;
					} else {
						adRequestParam = "Parameter " + adRequestParam + " is not present in the url"
					}
				}

				if (paramForValidation.includes(adRequestParam)) {
					var table1 = document.getElementById('tableBody');
					var rowrow = document.createElement('tr');
					expectedParam = getData(device, profileName, adRequestParam, deviceAdTracking, region);
					console.log("actualParamvalue is " + actualParamValue);
					validateParam(adRequestParam, actualParamValue, expectedParam, count1, table1, rowrow);
					count1++;
				} else {
					var table1 = document.getElementById('tableBody2');
					var rowrow = document.createElement('tr');
					validateAdditionParam(adRequestParam, actualParamValue, count2, table1, rowrow)
					count2++;
				}

			}




			// for (var a=0; a < paramArr.length; a++) {
			//   var table1 = document.getElementById('tableBody');
			//   var rowrow =  document.createElement('tr');

			//   var actualParam = "";
			//   var actualParamvalue ="";
			//   const expectedParam = getData(device,profileName,paramArr[a],deviceAdTracking,region);

			//   //let expectedParam = paramVal[a];

			//   if(search.has(paramArr[a])){
			// 	actualParam = paramArr[a];
			// 	if(paramArr[a] === 'vprn'){
			// 		let data = search.get(paramArr[a]);
			// 		actualParamvalue = data.split(';')[0];
			// 	}
			// 	else {
			// 		actualParamvalue = search.get(paramArr[a]);
			// 	} 
			//   }else{
			// 	if (paramArr[a] === 'hostvalue'){
			// 		actualParam = paramArr[a];
			//       	const { protocol, hostname } = url;
			// 		actualParamvalue = `${protocol}//${hostname}`;
			// 	}else{
			// 		actualParam = "Parameter "+paramArr[a]+" is not present in the url"
			// 	}
			//   }
			//   for ( i=0; i <1; i++) {

			// 				var cell1  =  document.createElement('td');
			//                 var text1 = document.createTextNode(count);


			//                 cell1.appendChild(text1);
			//                 rowrow.appendChild(cell1);
			//                 count = count+1;

			// 				var cell2  =  document.createElement('td');
			//                 var text2 = document.createTextNode(actualParam);


			//                 cell2.appendChild(text2);
			//                 rowrow.appendChild(cell2);

			//                 var cell3  =  document.createElement('td');
			//                 var text3 = document.createTextNode(actualParamvalue);


			//                 cell3.appendChild(text3);
			//                 rowrow.appendChild(cell3);

			//                 if(actualParam.includes('not present in the url')){
			//                     cell3.style.backgroundColor = "red";
			//                 }

			//                 var cell4  =  document.createElement('td');
			//                 var text4 = document.createTextNode(expectedParam);

			//                 cell4.appendChild(text4);
			//                 rowrow.appendChild(cell4);

			//                 var cell5  =  document.createElement('td');
			//                 var text5 = "";

			// 				if(["_fw_did"].includes(actualParam)){
			// 					if(deviceAdTracking === "disabled"){
			// 						if(!actualParamvalue){
			// 							text5 = document.createTextNode("PASS");
			// 							cell5.appendChild(text5);
			// 							rowrow.appendChild(cell5);
			// 							cell5.style.backgroundColor = "#6ae66a";
			// 						} else{
			//                   text5 = document.createTextNode("FAIL");
			//                   cell5.appendChild(text5);
			//                   rowrow.appendChild(cell5);
			//                   cell5.style.backgroundColor = "red";
			//                 }
			// 					} else if(deviceAdTracking === "enabled"){
			// 						if(actualParamvalue){
			// 							text5 = document.createTextNode("PASS");
			// 							cell5.appendChild(text5);
			// 							rowrow.appendChild(cell5);
			// 							cell5.style.backgroundColor = "#6ae66a";
			// 						} else{
			//                   text5 = document.createTextNode("FAIL");
			//                   cell5.appendChild(text5);
			//                   rowrow.appendChild(cell5);
			//                   cell5.style.backgroundColor = "red";
			//                 }
			// 					}
			// 				}else if(actualParamvalue === expectedParam){
			//                    text5 = document.createTextNode("PASS");
			//                    cell5.appendChild(text5);
			//                    rowrow.appendChild(cell5);
			//                    cell5.style.backgroundColor = "#6ae66a";
			//                 } else{
			//                   text5 = document.createTextNode("FAIL");
			//                   cell5.appendChild(text5);
			//                   rowrow.appendChild(cell5);
			//                   cell5.style.backgroundColor = "red";
			//                 }

			//           }
			//             table1.appendChild(rowrow);     
			// }



		}
	</script>
</head>

<body>
	<div style="border: 10px; align-items: center;">
		<h2 style="color: #3883fa;">
			<center>AdTech - Adrequest parameter validator</center>
		</h2>
		<br>
		<h4 id="error" style="color: red; margin-left: 15px; flex: 1 100%;"></h4>
		<div class="row" style="margin: 10px; display: flex; width: 100%; flex-wrap: wrap;">
			<div class="col-md" style="margin-right: 10px;">
				<label for="Country">Country:</label>
				<select id="Country" class="form-select">
					<option value="AUS">AUS</option>
					<option value="USA">USA</option>
					<option value="UK">UK</option>
					<option value="SE">SE</option>
					
				</select>
			</div>
			<div class="col-md" style="margin-right: 10px;">
				<label for="Device">Device:</label>
				<select id="device" class="form-select">
					<!-- Trying with 3 device now, will list more devices after POC-->
					<option value="Chrome">Chrome</option>
					<option value="Android">Android</option>
					<option value="iOS">iOS</option>
				</select>
			</div>
			<div class="col-md" style="margin-right: 10px;">
				<label for="profile">Profile:</label>
				<select id="profile" class="form-select">
					<!-- Trying with 3 device now, will list more devices after POC-->
					<option value="adult">adult</option>
					<option value="kids">kids</option>
					<option value="adult on child">adult on child</option>
				</select>
			</div>
			<div class="col-md" style="margin-right: 10px;">
				<label for="deviceAdTracking">Device Ad Tracking:</label>
				<select id="deviceAdTrackingSetting" class="form-select">
					<option value="enabled">Enabled</option>
					<option value="disabled">Disabled</option>
				</select>
			</div>
			<div class="col-md" style="margin-right: 10px;">
				<label for="CMPAdTracking">CMP Ad setting:</label>
				<select id="CMPAdTrackingSetting" class="form-select">
					<option value="notApplicable">Not Applicable</option>
					<option value="enabled">Consented</option>
					<option value="disabled">Not Consented</option>
					
				</select>
			</div>
			<div class="col-md" style="margin-right: 10px;">
				<label for="appVersion">EnterAppVersion</label>
				<input type="text" id="appVersion" style="width: 350px;">
				</input>
			</div>
			<div class="col-md" style="margin-right: 10px;">
				<label for="playbackId">Enter adRequest Url:</label>
				<input type="text" id="url" style="width: 350px;">
				</input>
			</div>
			<div class="col-md-3" style="margin-right: 10px;">
				<button class="btn btn-primary" style="margin-right: 10px;" onclick="add()">Submit</button>
				<!-- Corrected margin-right value -->
				<button class="btn btn-secondary" onclick="window.location.reload();">Clear</button>
			</div>
		</div>

		<br>
		<table class="col-lg-12" style="border: solid; padding:15x; margin: 10px; width: 98%;">
			<tr>
				<td style="margin-right: 10px; padding: 15px; text-align: left; width: 150px;">
					<h4 style="margin: 0; padding: 0; text-align: left;">AdrequestURL:</h4>
				</td>
				<td style="margin-right: 10px;; padding: 5px; text-align: left;">
					<h4 id="myText" style="margin: 0; padding: 0;"><i>AdrequestURL will appear here</i></h4>
				</td>
			</tr>
		</table>
		<br>
		<table class="col-lg-12" style="border: solid; padding:15x; margin: 10px; width: 98%; margin-bottom: 73px;"
			id="mytable">
			<thead>
				<tr>
					<td>
						<center>
							<h3>S.No</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Parameter</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Actual value</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Expected value</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Status</h3>
						</center>
					</td>
				</tr>
			</thead>
			<tbody id="tableBody">
			</tbody>
		</table>
		<br>
		<br>
		<h4 style="padding:15x; margin: 10px; width: 98%;"> Additional Adrequest Parameter validation:</h4>
		<table class="col-lg-12" style="border: solid; padding:15x; margin: 10px; width: 98%;" id="table2">
			<thead>
				<tr>
					<td>
						<center>
							<h3>S.No</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Parameter</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Actual value</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Expected value</h3>
						</center>
					</td>
					<td>
						<center>
							<h3>Status</h3>
						</center>
					</td>
				</tr>
			</thead>
			<tbody id="tableBody2">
			</tbody>
		</table>
		<br><br>
		<h5 style="text-align:right; margin-right: 25px;">Developed By GQA-Adtech</h5>
	</div>
	<script>
	</script>
</body>

</html>
