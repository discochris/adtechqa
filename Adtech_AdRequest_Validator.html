<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdTech - Ad Request Parameter Validator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        const getData = (device, profileName, adrequestParam, deviceAdTracking, region) => {
            let jsonData = {
                "commonParams":
                {
                    "deviceAdtrackingEnabled":
                    {
                        "adult":
                        {
                            "_fw_is_lat": "0",
                            "_fw_did": "855dfffc-8e47-4661-9b3c-3b625d487056",
                            "paln": "AQzzBGQEdiomKZVi7Uc1s-D87_l6er9Z6tgwhA8HdqUYtrMOPbLGG1_XPf5TSX2F7GKwbYN-6KE-tw6ZADczHrFq_bwA0srLNa9vjydhusRkwAp03wDRy_AD-4ANs7qUO-tHQWz4xowCLP_j8t-lOuQAL9wikvONM2PZ6VISYPl48RR59fqgsyv8a0rl2DJpPuo2UJbEK9wG_WSAIPW9NZvzev0cGD5iD2vK4chkNBL0LGvMi0N6TslCQ-2YJeqfUtWP3ZsDokLwr5Va9x0ZxNhjbyo7QgsUIBbckbaW3AnGW24adGDS-J9nDoBZs66r6UBJ7mipC1rufakbGgVnmqxJU-jFKQauzWKxTaqPIDYdjiXW11Eu0Zw7vd_IgqtUIWjiRyJttGFmwD_z1bCqoo9XR927o2GoKuvCbGNuIh6I5bxthTtPSEdF40SJ2mIyipYWv6sDhK2aEMGBRncL1-tDUTCJCfdQK4IeUSHWzVyejZ2YLccmnYa88LwkA7Hib-MDQ13VYc30_oYlcA8dvbEbhL65l3sytSD3zd6qw2U3m1ekpib3yDYuhuFAEaxqLryQlVpZyQav4OCK4AOHepcpyXVmH5lOmdbbtDFdOGq2957DEzwXGMYAWyhKRQjU8_RI2-fLX6ISAGdkE9Li8bSQIAm4fHlXhvuVMXjDnK821dHbHj8Uu5DJri2_FyOwh90wP5VqrM_XCsNIcvTvEVJQ6nlei5QfEbZN095CX_J2liouIbumqstp5xAjxgAwG2f3QVKSpZHCg9XIhBXejtpCTudEu_QP_6MXv8PFJ-VTJLq9gqrLOWuv9FfpuvcmP71q59Ag_4q66PNQuTw3xRd4rDkXJesXS0mxhj09r7NTThoXu3boss1wuwTMBPYtTvkfi8nKW5wDqcn5dt254fJTTbfx-6VE5qSblZzn8cZf-Z-NBuO-IsxuHcsMFJLozFjYnpXuu12mCJdoLju_GEMfdT3lEfDnBlubKb0omTRbRyfpoxIW74wtvPrvj2lfJJoRDQgJFdb1-Q-_9E9yL21IHto-BD0kFx0TYd77o6OxuujSos7mBoVxDXqqnjufbPUosjerEpJCpzNvj8wlSE5kSIlJoqxVnXFDCmihblUwCCOLIejxyDCQNF2CZH8y5rV1_USaKTVeX5uKq_-jrMlLPvfTqJsAYSLo_ZAK4UKLrMGOSybz4mAsVPmiEU8kqhFJk2ng"
                        },
                        "kids":
                        {
                            "_fw_is_lat": "1",
                            "_fw_did": null,
                            "paln": null
                        }
                    },
                    "deviceAdtrackingDisabled":
                    {
                        "adult": {
                            "_fw_is_lat": "1",
                            "_fw_did": null,
                            "paln": null
                        },
                        "kids":
                        {
                            "_fw_is_lat": "1",
                            "_fw_did": null,
                            "paln": null
                        }
                    },
                    "flag": " fbad scpv emcr sltp qtcb slcb aeti vicb dtrd",
                    "resp": "vmap1 vast4",
                    "mode": "on-demand"
                },
                "USA": {
                    "nw": "191700",
                    "afid": "370478572",
                    "hostvalue": "https://2ecd5.v.fwmrm.net"
                },
                "AUS": {
                    "nw": "386344",
                    "afid": "388328657",
                    "hostvalue": "https://5e529.v.fwmrm.net"
                },
                "BR": {
                    "nw": "386344",
                    "afid": "388328657",
                    "hostvalue": "https://5e528.v.fwmrm.net"
                },
                "Chrome": {
                    "platform": "web",
                    "_fw_us_privacy": "1---",
                    "metr": "135",
                    "_fw_gdpr": "0",
                    "adult": {
                        "USA": {
                            "playername": "BeamPlayerDesktop",
                            "csid": "beam/web/desktop",
                            "prof": "191700:beam_web_desktop_vod_test",
                        },
                        "AUS": {
                            "playername": "BeamPlayerDesktop/5.10.0",
                            "csid": "apac/max/AU/web/desktop",
                            "prof": "386344:dni_max_apac_web_vod_test",
                        },
                        "BR": {
                            "playername": "BeamPlayerDesktop",
                            "csid": "beam/web/desktop",
                            "prof": "191700:beam_web_desktop_vod_test",
                        },

                        "_fw_coppa": "0",
                        "restrictedProfile": "0"
                    },
                    "kids": {
                        "USA": {
                            "playername": "BeamPlayerDesktop",
                            "csid": "kidsprofile/beam/web/desktop",
                            "prof": "191700:beam_web_desktop_vod_test",
                        },
                        "AUS": {
                            "playername": "BeamPlayerDesktop/5.10.0",
                            "csid": "apac/max/AU/web/desktop",
                            "prof": "386344:dni_max_apac_web_vod_test",
                        },
                        "BR": {
                            "playername": "BeamPlayerDesktop",
                            "csid": "kidsprofile/beam/web/desktop",
                            "prof": "191700:beam_web_desktop_vod_test",
                        },

                        "_fw_coppa": "1",
                        "restrictedProfile": "1"
                    }
                },
                "Android": {
                    "playername": "DiscoveryPlayerAndroidgooglePlay/4.8.0",
                    "platform": "android",
                    "_fw_us_privacy": "1---",
                    "metr": "135",
                    "_fw_gdpr": "0",
                    "adult": {
                        "USA": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "BR": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "AUS": {
                            "csid": "apac/max/AU/app/android/phone",
                            "prof": "386344:dni_max_apac_android_vod_test",
                            "playername": "DiscoveryPlayerAndroidgooglePlay/5.10.0",
                        },
                        "_fw_coppa": "0",
                        "restrictedProfile": "0"
                    },
                    "kids": {
                        "USA": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "BR": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "_fw_coppa": "1",
                        "restrictedProfile": "1"
                    }
                },
                "iOS": {
                    "playername": "DiscoveryPlayeriosnative/1.0",
                    "platform": "ios",
                    "_fw_us_privacy": "1---",
                    "metr": "135",
                    "_fw_gdpr": "0",
                    "_fw_atts": "1",
                    "adult": {
                        "USA": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "BR": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "AUS": {
                            "csid": "apac/max/AU/app/ios/phone",
                            "prof": "386344:dni_max_apac_ios_vod_test",
                        },
                        "_fw_coppa": "0",
                        "restrictedProfile": "0"
                    },
                    "kids": {
                        "USA": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "BR": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "_fw_coppa": "1",
                        "restrictedProfile": "1"
                    }
                },
                "tvos": {
                    "playername": "DiscoveryPlayertvOSnative/1.0",
                    "platform": "tvos",
                    "metr": "1159",
                    "_fw_gdpr": "0",
                    "_fw_atts": "1",
                    "adult": {
                        "AUS": {
                            "csid": "apac/max/AU/ctv/tvos",
                            "prof": "386344:dni_max_apac_tvos_vod_test",
                            "playername": "DiscoveryPlayertvOSnative/1.0",
                        },
                        "_fw_coppa": "0",
                        "restrictedProfile": "0"
                    },
                    "kids": {
                        "USA": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "BR": {
                            "csid": "beam/app/android/phone",
                            "prof": "191700:beam_app_android_vod_test",
                        },
                        "_fw_coppa": "1",
                        "restrictedProfile": "1"
                    }
                }
            }

            let expectedData;
            switch (adrequestParam) {
                case "_fw_is_lat":
                case "paln":
                    if (deviceAdTracking === "enabled") {
                        expectedData =
                            jsonData.commonParams.deviceAdtrackingEnabled[profileName][
                            adrequestParam
                            ];
                    } else if (deviceAdTracking === "disabled") {
                        expectedData =
                            jsonData.commonParams.deviceAdtrackingDisabled[profileName][
                            adrequestParam
                            ];
                    }
                    break;
                case "_fw_coppa":
                case "restrictedProfile":
                    expectedData = jsonData[device][profileName][adrequestParam];
                    break;
                case "csid":
                case "prof":
                case "playername":
                    expectedData = jsonData[device][profileName][region][adrequestParam];
                    break;
                case "flag":
                case "resp":
                case "mode":
                    expectedData = jsonData.commonParams[adrequestParam];
                    break;
                case "nw":
                case "afid":
                case "hostvalue":
                    expectedData = jsonData[region][adrequestParam];
                    break;                  
                default:
                    expectedData = jsonData[device][adrequestParam];
                    console.log("Expected data is " + expectedData);
            }

            return expectedData;
        }

        const validateParam = (actualParam, actualParamValue, expectedParamValue, count, table1, rowrow) => {
            for (i = 0; i < 1; i++) {

                var cell1 = document.createElement('td');
                var text1 = document.createTextNode(count);


                cell1.appendChild(text1);
                rowrow.appendChild(cell1);

                var cell2 = document.createElement('td');
                var text2 = document.createTextNode(actualParam);


                cell2.appendChild(text2);
                rowrow.appendChild(cell2);

                var cell3 = document.createElement('td');
                var text3 = document.createTextNode(actualParamValue);


                cell3.appendChild(text3);
                rowrow.appendChild(cell3);

                if (actualParam.includes('not present in the url')) {
                    cell3.style.backgroundColor = "red";
                }

                var cell4 = document.createElement('td');
                var text4 = document.createTextNode(expectedParamValue);

                cell4.appendChild(text4);
                rowrow.appendChild(cell4);

                var cell5 = document.createElement('td');
                var text5 = "";

                if (["_fw_did"].includes(actualParam)) {
                    if (deviceAdTracking === "disabled") {
                        if (!actualParamValue) {
                            text5 = document.createTextNode("PASS");
                            cell5.appendChild(text5);
                            rowrow.appendChild(cell5);
                            cell5.style.backgroundColor = "#6ae66a";
                        } else {
                            text5 = document.createTextNode("FAIL");
                            cell5.appendChild(text5);
                            rowrow.appendChild(cell5);
                            cell5.style.backgroundColor = "red";
                        }
                    } else if (deviceAdTracking === "enabled") {
                        if (actualParamValue) {
                            text5 = document.createTextNode("PASS");
                            cell5.appendChild(text5);
                            rowrow.appendChild(cell5);
                            cell5.style.backgroundColor = "#6ae66a";
                        } else {
                            text5 = document.createTextNode("FAIL");
                            cell5.appendChild(text5);
                            rowrow.appendChild(cell5);
                            cell5.style.backgroundColor = "red";
                        }
                    }
                } else if (actualParamValue == expectedParamValue) {
                    text5 = document.createTextNode("PASS");
                    cell5.appendChild(text5);
                    rowrow.appendChild(cell5);
                    cell5.style.backgroundColor = "#6ae66a";
                } else {
                    text5 = document.createTextNode("FAIL");
                    cell5.appendChild(text5);
                    rowrow.appendChild(cell5);
                    cell5.style.backgroundColor = "red";
                }

            }
            table1.appendChild(rowrow);
        }


        //===================================================================================================================

        const validateAdditionParam = (actualParam, actualParamValue, count, table1, rowrow) => {
            for (i = 0; i < 1; i++) {

                var cell1 = document.createElement('td');
                var text1 = document.createTextNode(count);


                cell1.appendChild(text1);
                rowrow.appendChild(cell1);

                var cell2 = document.createElement('td');
                var text2 = document.createTextNode(actualParam);


                cell2.appendChild(text2);
                rowrow.appendChild(cell2);

                var cell3 = document.createElement('td');
                var text3 = document.createTextNode(actualParamValue);


                cell3.appendChild(text3);
                rowrow.appendChild(cell3);

                if (actualParam.includes('not present in the url')) {
                    cell3.style.backgroundColor = "red";
                }

                var cell4 = document.createElement('td');
                var text4 = document.createTextNode("Expected String/Numeric Value");

                cell4.appendChild(text4);
                rowrow.appendChild(cell4);

                var cell5 = document.createElement('td');
                var text5 = "";

                if (actualParamValue) {
                    text5 = document.createTextNode("PASS");
                    cell5.appendChild(text5);
                    rowrow.appendChild(cell5);
                    cell5.style.backgroundColor = "#6ae66a";
                } else {
                    text5 = document.createTextNode("FAIL");
                    cell5.appendChild(text5);
                    rowrow.appendChild(cell5);
                    cell5.style.backgroundColor = "red";
                }

            }
            table1.appendChild(rowrow);

        }

        async function add() {
            document.getElementById("tableBody").innerHTML = "";
            document.getElementById("tableBody2").innerHTML = "";
            let adUrl = document.getElementById("url").value;
            let profileName = document.getElementById("profile").value;
            let device = document.getElementById("device").value;
            let deviceAdTracking = document.getElementById("deviceAdTrackingSetting").value;
            let region = document.getElementById("Country").value;
            let appVersion = document.getElementById("appVersion").value;

            document.getElementById("myText").innerHTML = adUrl;

            adUrl = adUrl.replace(/;ptgt/g, '&ptgt');


            var url = new URL(adUrl);
            let search = new URLSearchParams(url.search);
            let paramArr = ['nw', 'csid', 'caid', 'hostvalue', 'afid', 'pvrn', 'vprn', 'flag', 'metr', 'prof', 'resp', 'vdur', 'vip', 'mode', ';_fw_vcid2', 'accountid', '_fw_did', '_fw_h_user_agent', '_fw_h_referer', '_fw_coppa', 'restrictedProfile', '_fw_gdpr', '_fw_is_lat', '_fw_atts', 'preroll', 'product', 'paln', 'platform', 'program_id', 'playbackId', 'playername', '_fw_nielsen_app_id', 'ptgt', 'tpcl', 'cpsq', 'tpos', '_fw_cookie_consent', '_fw_gdpr_consent','_fw_content_language'];
            //let paramArr = ['_fw_coppa','restrictedProfile'];
            let paramForValidation = ['nw', 'csid', 'hostvalue', 'afid', 'flag', 'metr', 'prof', 'resp', 'mode', '_fw_coppa', 'restrictedProfile', '_fw_gdpr', '_fw_is_lat', '_fw_atts', 'platform', 'playername']



            //console.log("params are "+JSON.stringify(expData));
            //console.log(expData.commonParams);
            let count1 = 1;
            let count2 = 1;

            for (var i = 0; i < paramArr.length; i++) {
                var adRequestParam = paramArr[i];
                var actualParamValue = "";
                let expectedParam;
                if (search.has(paramArr[i])) {
                    if (adRequestParam === 'vprn') {
                        let data = search.get(adRequestParam);
                        actualParamValue = data.split(';')[0];
                    }
                    else if (adRequestParam === 'flag') {
                        let data = search.get(adRequestParam);
                        actualParamValue = data.split(';')[0];
                    }
                    else {
                        actualParamValue = search.get(adRequestParam);
                    }
                } else {
                    if (adRequestParam === 'hostvalue') {
                        const { protocol, hostname } = url;
                        actualParamValue = `${protocol}//${hostname}`;
                    } else {
                        adRequestParam = "Parameter " + adRequestParam + " is not present in the url"
                    }
                }

                if (paramForValidation.includes(adRequestParam)) {
                    var table1 = document.getElementById('tableBody');
                    var rowrow = document.createElement('tr');
                    expectedParam = getData(device, profileName, adRequestParam, deviceAdTracking, region);
                    console.log("actualParamvalue is " + actualParamValue);
                    validateParam(adRequestParam, actualParamValue, expectedParam, count1, table1, rowrow);
                    count1++;
                } else {
                    var table1 = document.getElementById('tableBody2');
                    var rowrow = document.createElement('tr');
                    validateAdditionParam(adRequestParam, actualParamValue, count2, table1, rowrow)
                    count2++;
                }
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h2 class="title">AdTech - Ad Request Parameter Validator</h2>
        <h4 id="error" class="text-danger text-center"></h4>

        <div class="row g-3">
            <div class="col-md-4">
                <label for="Country" class="form-label">Country</label>
                <select id="Country" class="form-select">
                    <option value="AUS">AUS</option>
                    <option value="USA">USA</option>
                    <option value="UK">UK</option>
                    <option value="SE">SE</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="device" class="form-label">Device</label>
                <select id="device" class="form-select">
                    <option value="Chrome">Chrome</option>
                    <option value="Android">Android</option>
                    <option value="iOS">iOS</option>
                    <option value="tvos">TVOS</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="profile" class="form-label">Profile</label>
                <select id="profile" class="form-select">
                    <option value="adult">Adult</option>
                    <option value="kids">Kids</option>
                    <option value="adult on child">Adult on Child</option>
                </select>
            </div>
        </div>

        <div class="row g-3 mt-2">
            <div class="col-md-4">
                <label for="deviceAdTracking" class="form-label">Device Ad Tracking</label>
                <select id="deviceAdTrackingSetting" class="form-select">
                    <option value="enabled">Enabled</option>
                    <option value="disabled">Disabled</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="CMPAdTracking" class="form-label">CMP Ad Setting</label>
                <select id="CMPAdTrackingSetting" class="form-select">
                    <option value="notApplicable">Not Applicable</option>
                    <option value="enabled">Consented</option>
                    <option value="disabled">Not Consented</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="appVersion" class="form-label">Enter App Version</label>
                <input type="text" id="appVersion" class="form-control" placeholder="5.9, 5.10, etc">
            </div>
        </div>

        <div class="row g-3 mt-2">
            <div class="col-md-8">
                <label for="url" class="form-label">Enter Ad Request URL</label>
                <input type="text" id="url" class="form-control" placeholder="Enter URL here">
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-primary w-100" onclick="add()">Submit</button>
            </div>
        </div>

        <div class="table-responsive mt-4">
            <!-- <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th class="text-center">Ad Request URL: </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="myText" class="text-muted" style="white-space: nowrap;"><i>Ad Request URL will appear here</i></td>
                    </tr>
                </tbody>
            </table> -->

             <table class="table table-bordered">
    <thead class="table-dark">
        <tr>
            <td style="margin-right: 10px; padding: 15px; text-align: left; width: 150px;">
                <h6 style="margin: 0; padding: 0; text-align: left;">AdrequestURL:</h6>
            </td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="margin-right: 10px; padding: 5px; text-align: left;">
                <p id="myText" style="margin: 0; padding: 0; font-size: 12px;">
                    <i>AdrequestURL will appear here</i>
                </p>
            </td>
        </tr>
    </tbody>
</table>


        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>S.No</th>
                        <th>Parameter</th>
                        <th>Actual Value</th>
                        <th>Expected Value</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="table-responsive mt-4">
            <table class="table table-bordered table-striped" id="table2">
                <colgroup>
                    <col style="width: 50px;">   <!-- S.No -->
                    <col style="width: 200px;">  <!-- Parameter -->
                    <col style="width: 250px;">  <!-- Actual Value -->
                    <col style="width: 250px;">  <!-- Expected Value -->
                    <col style="width: 100px;">  <!-- Status -->
                </colgroup>
                <thead class="table-dark">
                    <tr>
                        <th colspan="5" class="text-center">Additional Ad Request Parameter Validation</th>
                    </tr>
                    <tr>
                        <th>S.No</th>
                        <th>Parameter</th>
                        <th>Actual Value</th>
                        <th>Expected Value</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody2"></tbody>
            </table>
        </div>

        <p class="footer">Developed by GQA - AdTech</p>
    </div>

<!--     <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("#tableBody2 td:nth-child(3)").forEach(function(td) {
                if (td.innerText.length > 50) {
                    td.innerText = td.innerText.substring(0, 50) + "...";
                }
            });
        });
    </script> -->

    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .container {
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
        }
        .title {
            color: #3883fa;
            text-align: center;
            margin-bottom: 20px;
        }
        .form-select, .form-control {
            border-radius: 8px;
        }
        .btn {
            border-radius: 8px;
            transition: 0.3s;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .table {
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        .table th, .table td {
            text-align: left;
            vertical-align: text-top;
        }
        .table th:nth-child(3),
        .table td:nth-child(3) { /* Restrict "Actual Value" column width */
            width: 250px;
            max-width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .footer {
            text-align: right;
            margin-top: 20px;
            font-size: 14px;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
